# 用户指南

## 目录

1. [快速开始](#快速开始)
2. [基本操作](#基本操作)
3. [自然语言命令](#自然语言命令)
4. [WinDBG 命令](#windbg-命令)
5. [显示模式](#显示模式)
6. [高级功能](#高级功能)
7. [故障排除](#故障排除)

## 快速开始

### 安装

1. 确保已安装 Python 3.10+
2. 安装依赖：`pip install -r requirements.txt`
3. 配置 `.env` 文件（可选，用于 LLM 功能）
4. 运行：`python main.py`

### 第一次使用

1. 启动应用后，输入转储文件路径
2. 等待转储文件加载完成
3. 输入命令开始分析

## 基本操作

### 加载转储文件

```
文件路径> C:\path\to\your\crash.dmp
```

支持拖拽文件到命令行窗口。

### 查看帮助

```
> help
```

### 清屏

```
> clear
```

### 查看状态

```
> status
```

### 退出程序

```
> exit
```

或按 `Ctrl+C`

## 自然语言命令

### 崩溃分析

```
> 帮我分析崩溃
> 分析这个崩溃
> 查看崩溃原因
```

### 查看调用栈

```
> 查看调用栈
> 显示堆栈
> 查看函数调用
```

### 查看异常信息

```
> 查看异常
> 显示异常信息
> 异常记录
```

### 查看模块

```
> 查看模块
> 显示加载的模块
> 列出所有 DLL
```

### 查看线程

```
> 查看线程
> 显示线程信息
```

### 查看内存

```
> 查看内存 0x12345678
> 显示地址 0x12345678 处的内存
```

### 查看寄存器

```
> 查看寄存器
> 显示寄存器状态
```

## WinDBG 命令

### 常用命令

| 命令 | 说明 |
|------|------|
| `!analyze -v` | 详细崩溃分析 |
| `k` | 查看调用栈 |
| `kv` | 查看详细调用栈 |
| `kp` | 查看带参数的调用栈 |
| `.exr -1` | 查看异常记录 |
| `~` | 查看线程信息 |
| `~*` | 查看所有线程信息 |
| `lm` | 查看模块列表 |
| `lmv` | 查看详细模块信息 |
| `r` | 查看寄存器 |
| `u` | 反汇编 |
| `.reload` | 重新加载符号 |

### 内存操作

| 命令 | 说明 |
|------|------|
| `db <addr>` | 查看字节 |
| `dw <addr>` | 查看字 |
| `dd <addr>` | 查看双字 |
| `da <addr>` | 查看 ASCII 字符串 |
| `du <addr>` | 查看 Unicode 字符串 |

### 符号操作

| 命令 | 说明 |
|------|------|
| `.sympath <path>` | 设置符号路径 |
| `.reload` | 重新加载符号 |
| `.reload /f` | 强制重新加载符号 |

## 显示模式

### 切换模式

```
> mode raw      # 原始输出模式
> mode smart    # 智能分析模式
> mode both     # 同时显示两种模式
```

### 模式说明

#### Raw 模式

只显示 WinDBG 的原始输出，适合熟悉 WinDBG 的用户。

#### Smart 模式

显示 WinDBG 原始输出，同时显示 LLM 生成的智能分析报告。

#### Both 模式

同时显示原始输出和智能分析报告。

## 高级功能

### 命令历史

- 使用 `↑` 和 `↓` 键浏览历史命令
- 历史命令自动保存到文件

### 输入验证

应用会自动验证输入，防止执行危险命令。

### 缓存机制

LLM 响应会被缓存，相同的分析请求会直接返回缓存结果。

### 日志记录

应用会记录运行日志，位于 `~/.ai_windbg.log`。

## 故障排除

### WinDBG 未找到

**症状**: 启动时提示未检测到 WinDBG

**解决方案**:
1. 确保已安装 WinDBG
2. 在 `config.yaml` 中配置正确的 WinDBG 路径
3. 或将 WinDBG 添加到系统 PATH

### 转储文件加载失败

**症状**: 加载转储文件时提示失败

**解决方案**:
1. 确认文件路径正确
2. 确认文件是有效的 .dmp 文件
3. 检查文件权限

### LLM 功能不可用

**症状**: 智能分析功能不工作

**解决方案**:
1. 检查 `.env` 文件中是否配置了有效的 OpenAI API Key
2. 检查网络连接
3. 检查 API 配额是否充足

### 符号加载失败

**症状**: 符号加载失败或延迟

**解决方案**:
1. 检查符号路径配置
2. 确保可以访问微软符号服务器
3. 考虑使用本地符号缓存

### 性能问题

**症状**: 应用响应缓慢

**解决方案**:
1. 清除 LLM 缓存
2. 减少输出显示行数
3. 使用 raw 模式减少 LLM 调用

## 最佳实践

1. **使用自然语言**: 对于常见操作，使用自然语言更方便
2. **合理使用模式**: 根据需要切换显示模式
3. **利用命令历史**: 使用历史命令提高效率
4. **保存分析结果**: 定期导出重要的分析报告
5. **保持符号更新**: 确保符号文件是最新的

## 获取帮助

- 查看内置帮助：输入 `help`
- 查看项目文档：[README.md](README.md)
- 提交问题：[GitHub Issues](https://github.com/yourusername/ai-windbg/issues)
